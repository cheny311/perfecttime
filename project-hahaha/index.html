<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yingyu Chen - Portfolio</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/addons/p5.sound.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tomorrow:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="sketch.js" defer></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="container">
        
        <div class="top-section">
            <header class="main-header">
                <h1 class="title-large">Hahaha</h1>
                <p class="subtitle">automated laughter</p>
            </header>
            
            <nav class="project-sidebar">
                <span class="list-label">project list</span>
                <ul>
                    <li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li>
                    <li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li>
                </ul>
            </nav>
        </div>

        <main class="gallery-section">
           
    <div class="ha-svg-wrapper">
        <main class="content-middle">
    <div class="box-img left-img" id="p5-container"></div>

    <div class="ha-character">
        <img src="ha.svg" alt="哈" class="ha-svg-file">
    </div>

    <div class="box-img right-img">
        <div class="ha-video">
            <video id="ha-video" src="hahaha.mp4" autoplay loop muted playsinline></video>
            <div class="video-controls">
                <button id="btn-play">Pause</button>
                <button id="btn-mute">Unmute</button>
                <label class="volume-label">Vol
                    <input id="volume-slider" type="range" min="0" max="1" step="0.05" value="0.5">
                </label>
            </div>
        </div>
    </div>
</main>
            </div>
        </main>

        <div class="photo-frame">
            <img src="ha.svg" alt="photo" class="photo-img">
            <div class="photo-hint">点击查看更多照片</div>
        </div>

        <section class="footer-content">
            <div class="vertical-text-group">
                <div class="v-text">2D version</div>
                <div class="v-text">Interaction demo</div>
            </div>

            <div class="main-paragraph">
                <p>大段落文字是非成败转头空，青山依旧在，惯看秋月春风。一壶浊酒喜相逢，古今多少事，滚滚长江东逝水，浪花淘尽英雄。几度夕阳红。白是非成败转头空，青山依旧在，惯看秋月春风。一壶浊酒喜相逢，古今多少事，滚滚长江东逝水，浪花淘尽英雄。</p>
            </div>

            <div class="side-paragraph">
                <p>是非成败转头空，青山依旧在，惯看秋月春风。一壶浊酒喜相逢，古今多少事，滚滚长江东逝水，浪花淘尽英雄。几度夕阳红。白发渔樵江渚上，都付笑谈中。</p>
            </div>
        </section>

        <footer class="bottom-nav">
            <a href="#">contact</a>
            <a href="#">home</a>
            <a href="#" class="active">readmore</a>
        </footer>
    </div>
</body>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const video = document.getElementById("ha-video");
  const btnPlay = document.getElementById("btn-play");
  const btnMute = document.getElementById("btn-mute");
  const volumeSlider = document.getElementById("volume-slider");
  const videoWrap = document.querySelector(".ha-video"); // 作为拖拽手柄
  const videoBox = document.querySelector(".right-img"); // 实际移动的框

  if (!video || !videoBox) return;

  // 初始状态
  video.volume = parseFloat(volumeSlider?.value || "0.5");
  // 从 CSS 读取初始 transform，避免依赖 data 属性
  const initial = getTranslateFromStyle(videoBox);
  videoBox.dataset.x = initial.x.toString();
  videoBox.dataset.y = initial.y.toString();
  videoBox.style.transform = `translate(${videoBox.dataset.x}px, ${videoBox.dataset.y}px)`;

  btnPlay?.addEventListener("click", () => {
    if (video.paused) {
      video.play();
      btnPlay.textContent = "Pause";
    } else {
      video.pause();
      btnPlay.textContent = "Play";
    }
  });

  btnMute?.addEventListener("click", () => {
    video.muted = !video.muted;
    btnMute.textContent = video.muted ? "Unmute" : "Mute";
  });

  volumeSlider?.addEventListener("input", (e) => {
    const v = parseFloat(e.target.value);
    video.volume = v;
    if (video.muted && v > 0) {
      video.muted = false;
      btnMute.textContent = "Mute";
    }
  });

  // 简易拖拽
  if (videoWrap) {
    let dragging = false;
    let startX = 0, startY = 0;
    let baseX = 0, baseY = 0;

    const onPointerDown = (evt) => {
      dragging = true;
      videoBox.style.cursor = "grabbing";
      baseX = parseFloat(videoBox.dataset.x || "0");
      baseY = parseFloat(videoBox.dataset.y || "0");
      startX = evt.clientX;
      startY = evt.clientY;
      evt.preventDefault();
      document.addEventListener("pointermove", onPointerMove);
      document.addEventListener("pointerup", onPointerUp);
    };

    const onPointerMove = (evt) => {
      if (!dragging) return;
      const dx = evt.clientX - startX;
      const dy = evt.clientY - startY;
      const newX = baseX + dx;
      const newY = baseY + dy;
      videoBox.style.transform = `translate(${newX}px, ${newY}px)`;
    };

    const onPointerUp = () => {
      dragging = false;
      videoBox.style.cursor = "grab";
      // 记录当前位置用于下次拖拽
      const match = videoBox.style.transform.match(/translate\(([-\d.]+)px,\s*([-\d.]+)px\)/);
      if (match) {
        videoBox.dataset.x = match[1];
        videoBox.dataset.y = match[2];
      }
      document.removeEventListener("pointermove", onPointerMove);
      document.removeEventListener("pointerup", onPointerUp);
    };

    (videoWrap || videoBox).addEventListener("pointerdown", onPointerDown);
  }
});

// 解析元素的 translate，返回 {x,y}
function getTranslateFromStyle(el) {
  const style = getComputedStyle(el);
  const matrix = style.transform;
  if (!matrix || matrix === "none") return { x: 0, y: 0 };
  const match = matrix.match(/matrix\(1, 0, 0, 1, ([\-0-9.]+), ([\-0-9.]+)\)/) ||
                matrix.match(/matrix\(a, b, c, d, ([\-0-9.]+), ([\-0-9.]+)\)/) ||
                matrix.match(/translate\(([\-0-9.]+)px,\s*([\-0-9.]+)px\)/);
  if (match) {
    return { x: parseFloat(match[1]) || 0, y: parseFloat(match[2]) || 0 };
  }
  return { x: 0, y: 0 };
}
</script>
</html>
